<!DOCTYPE html>
<html>
<head>
    <title>首页</title>
<!--    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link href="files/main/styles.css" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href="resources/css/bootstrap.min.css">
    <script type="text/javascript" src="resources/scripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="resources/scripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="resources/scripts/common.js"></script>
</head>
<style>*,body,html,div,p,img{border:0;margin:0;padding:0;} </style>
<body>

<!-- Unnamed (矩形) -->
<div style="position: fixed;top:0; bottom: auto; width: 100%; background: white;" class="footer">
    <div>
        <div id="u36_div" class=""></div>
    </div>
    <div id="u41" class="text" style="visibility: visible; background-color:rgba(255, 240, 245, 1); text-align:center;">
        <p id="head_tag" style="font-size:14px; padding-top:10px; padding-bottom:5px;">
            <span id="recommend_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700;color:#FF0000; margin:6%;" onclick="init('recommend')">推荐</span>
            <span id="news_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700; margin:6%; color: #000000;" onclick="init('news')">新闻</span>
            <span id="military_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700; margin:6%; color: #000000;" onclick="init('military')">军事</span>
            <span id="character_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700; margin:6%; color: #000000;" onclick="init('character')">人物</span>
            <span id="history_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700; margin:6%; color: #000000;" onclick="init('history')">史实</span>
        </p>
        <p style="height:5px;">
            <img id="recommend_line" style="border:0;margin-bottom:20px; padding:0; visibility:hidden;" src="images/首页/u42.png"/>
            <img id="news_line" style="border:0;margin-bottom:20px; padding:0; visibility:hidden;" src="images/首页/u42.png"/>
            <img id="military_line" style="border:0;margin-bottom:20px; padding:0; visibility:hidden;" src="images/首页/u42.png"/>
            <img id="character_line" style="border:0;margin-bottom:20px; padding:0; visibility:hidden;" src="images/首页/u42.png"/>
            <img id="history_line" style="border:0;margin-bottom:20px; padding:0; visibility:hidden;" src="images/首页/u42.png"/>
        </p>
    </div>
    <div class="ax_default _图片">
        <img id="u46_img" class="img " src="images/首页/search.png"/>
    </div>

    <!-- Unnamed (图片) -->
    <div>
        <img id="u48_img" class="img " src="images/首页/logo.png"/>
    </div>
</div>

<div id="top_div">
    <!-- 头条图片 -->
    <div style="margin-top: 85px; margin-bottom:-10px;">
        <img id="u44_img" class="img " src=""/>
    </div>
    <!-- 头条标题 -->
    <div id="u50_div" style="background-color:rgba(242, 242, 242, 1); magin-top: 0;">
        <p style="font-weight: 700; text-align:center; padding-top: 15px; font-size: 18px;"><span id="top_title"></span></p>
    </div>
</div>

<!-- 资讯盒子 -->
<div id="articles" style="margin-top:25px">
    <!--一条资讯
    <div style="margin: 15px;">
      <div class="text" style="visibility: visible;">
        <p><span>秦永伦：一寸山河一寸金，十万青年十万军</span></p>
      </div>
    </div>
    <div style="margin-top: -5px; margin-left: 15px; font-size:14px; color: #6C6C6C">
      <p><span>红旗下&nbsp; 2019-04-26</span></p>
    </div>
    <div>
      <img style="width: 100%" src="images/首页/u58.png"/>
    </div>
    -->
</div>


<div id="space" style="height: 70px;"></div>

<div id="foot" style="position: fixed;top:auto; bottom: 0; width: 100%; background: white; height: 70px;" class="footer">
    <div style="font-size: 15px; text-align:center;">
        <img id="school_image" onclick="go_part('school')" style="margin-left:6%; margin-right: 6%; margin-top: 10px; margin-bottom: 5px; width: 28px;" src="images/首页/message0.png"/>
        <img id="study_image" style="margin-left:6%; margin-right: 6%; margin-top: 10px; margin-bottom: 5px; width: 28px;" src="images/首页/study0.png"/>
        <img id="main_image" style="margin-left:6%; margin-right: 6%; margin-top: 10px; margin-bottom: 5px; width: 28px;" src="images/首页/main.png"/>
        <img id="home_image" style="margin-left:6%; margin-right: 6%; margin-top: 10px; margin-bottom: 5px; width: 28px;" src="images/首页/home0.png"/>
        <img id="me_image" onclick="go_part('me')" style="margin-left:6%; margin-right: 6%; margin-top: 10px; margin-bottom: 5px; width: 28px;" src="images/首页/me0.png"/>
    </div>
    <div id="foot_tag" style="font-size: 14px; text-align:center;">
        <span id="school_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';margin:6%; width: 18px;">校园</span>
        <span id="study_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';margin:6%; width: 18px;">学习</span>
        <span id="main_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';font-weight:700; margin:6%; width: 18px;">首页</span>
        <span id="home_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';margin:6%; width: 18px;">基地</span>
        <span id="me_tag" style="font-family:'Arial Negreta', 'Arial Normal', 'Arial';margin:6%; width: 18px;">我的</span>
    </div>
</div>
</body>
<script>
    var partName = "recommend";
    var num = -1;
    var top_id = -1;
    var top_type = "";
    var top_date = "";
    var alreadyCache = 0;

    var alreadyNews = 0;
    var alreadyHistory = 0;
    var alreadyCharacter = 0;
    var alreadyRecommend = 0;
    var alreadyMilitary = 0;

    adjustView();

    // 加载本地缓存的文章的方法
    function loadAppCache() {
        loadCacheTop(partName);
        loadCacheArticles(partName);
        alreadyCache = 1;
    }
    function loadCacheTop(partName) {
        var topStr = windows.android.getTopArticle(partName);
        var top = JSON.parse(topStr);
        showTop(top);
    }
    function loadCacheArticles(partName) {
        var str = windows.android.getArticles(partName);
        var list = JSON.parse(str);
        showList(list, 0);
    }
    function loadAppCache(part) {
        if (part == "news") {
            var state = alreadyNews;
            alreadyNews = 1;
            return state;
        }
        if (part == "history") {
            var state = alreadyHistory;
            alreadyHistory = 1;
            return state;
        }
        if (part == "character") {
            var state = alreadyCharacter;
            alreadyCharacter = 1;
            return state;
        }
        if (part == "recommend") {
            var state = alreadyRecommend;
            alreadyRecommend = 1;
            return state;
        }
        if (part == "military") {
            var state = alreadyMilitary;
            alreadyMilitary = 1;
            return state;
        }
    }

    // 从服务器获取文章列表
    function loadArticles() {
        $.ajax({
            url:_url_()+"/hqx_newsview/articles",
            type:"POST",
            data:{
              part:partName,
              index:num
            },
            success:function(result) {
              console.log(result);
              result = result.data;
              showList(result, 1);
            }
        });
    }
    // 显示文章列表 参数为文章list 和 标志(1:保存至缓存 其他:不保存)
    function showList(result, flag) {
        for (var i = 0; i < result.length; i++) {
            var articles = document.getElementById('articles').innerHTML;
            document.getElementById('articles').innerHTML = articles +
                '<div onclick="window.android.toArticle(' + '\'' + result[i].htmlUrl + '\', ' + result[i].id + ')" style="margin-top: -10px">'+
                    '<div style="margin: 15px;">'+
                        '<div class="text">'+
                            '<p><span style="font-size: 15px;">' + result[i].title + '</span></p>'+
                        '</div>'+
                    '</div>'+
                '<div style="margin-top: -5px; margin-left: 15px; font-size:14px; color: #6C6C6C">'+
                    '<p><span>' + result[i].type + '&nbsp; ' + result[i].date + '</span></p>'+
                '</div>'+
                '<div style="margin-top:5px;"><img style="width: 100%" src="images/首页/u58.png"/></div></div>';
            num = result[i].id;

            if (flag == 1) {
                //sql.Date转化问题
                //window.android.saveArticle(partName, JSON.stringify(result[i]));
            }
         }
    }

    // 从服务器获取头条信息
    function loadTop() {
        $.ajax({
            url:_url_()+"/hqx_newsview/top",
            type:"POST",
            data:{
              part:partName,
            },
            success:function(result) {
              console.log(result);
              showTop(result);
            }
        });
    }
    // 显示头条信息
    function showTop(result) {
        result = result.data;
        document.getElementById('u44_img').src = result.picUrl;
        document.getElementById('top_title').innerHTML = result.title;

        document.getElementById('top_div').value = result.htmlUrl;
        document.getElementById('top_div').onclick = read_top;
        top_id = result.id;
        top_type = result.type;
        top_date = result.date;
    }

    // 初始化界面 加载队形栏目的文章
    function init(part) {
        tag_change(part);
        num = 0;
        partName = part;
        document.getElementById('articles').innerHTML = "";
        document.getElementById('u44_img').src = "";
        document.getElementById('top_title').innerHTML = "";
        // TODO 优先从缓存找 刷新才访问服务器
        //if (alreadyCache(part) == 0) {
            // 表示还没从缓存中取 现在从缓存中取
            //loadAppCache();
        //}

        // TDDO 刷新时才会调用以下 现在不应该放在这里
        loadTop();
        loadArticles();
    }
    function tag_change(part) {
        document.getElementById(partName + "_tag").style.color = '#000000';
        document.getElementById(part + "_tag").style.color = '#FF0000';
        document.getElementById(partName + "_line").style.visibility = 'hidden';
        document.getElementById(part + "_line").style.visibility = 'visible';
    }
    init("news");



    function read_top() {
      console.log(this.value);
      window.android.toArticle(this.value, top_id);
    }

    function go_part(partName) {
      window.android.goPart(partName);
    }



    function adjustView(){
        var width = document.body.clientWidth;

        var fontSize = width / 24;
        var imageSize = width / 12;
        document.getElementById('head_tag').style.fontSize = fontSize + 'px';
        document.getElementById('recommend_tag').style.margin = fontSize + 'px';
        document.getElementById('news_tag').style.margin = fontSize + 'px';
        document.getElementById('military_tag').style.margin = fontSize + 'px';
        document.getElementById('character_tag').style.margin = fontSize + 'px';
        document.getElementById('history_tag').style.margin = fontSize + 'px';


        document.getElementById('recommend_line').style.marginLeft = fontSize + 'px';
        document.getElementById('news_line').style.marginLeft = fontSize + 'px';
        document.getElementById('military_line').style.marginLeft = fontSize + 'px';
        document.getElementById('character_line').style.marginLeft = fontSize + 'px';
        document.getElementById('history_line').style.marginLeft = fontSize + 'px';
        document.getElementById('recommend_line').style.marginRight = fontSize + 'px';
        document.getElementById('news_line').style.marginRight = fontSize + 'px';
        document.getElementById('military_line').style.marginRight = fontSize + 'px';
        document.getElementById('character_line').style.marginRight = fontSize + 'px';
        document.getElementById('history_line').style.marginRight = fontSize + 'px';

        document.getElementById('recommend_line').style.width = imageSize + 'px';
        document.getElementById('news_line').style.width = imageSize + 'px';
        document.getElementById('military_line').style.width = imageSize + 'px';
        document.getElementById('character_line').style.width = imageSize + 'px';
        document.getElementById('history_line').style.width = imageSize + 'px';


        document.getElementById('school_image').style.margin = fontSize + 'px';
        document.getElementById('home_image').style.margin = fontSize + 'px';
        document.getElementById('study_image').style.margin = fontSize + 'px';
        document.getElementById('main_image').style.margin = fontSize + 'px';
        document.getElementById('me_image').style.margin = fontSize + 'px';

        document.getElementById('school_image').style.width = imageSize + 'px';
        document.getElementById('home_image').style.width = imageSize + 'px';
        document.getElementById('study_image').style.width = imageSize + 'px';
        document.getElementById('main_image').style.width = imageSize + 'px';
        document.getElementById('me_image').style.width = imageSize + 'px';


        document.getElementById('foot_tag').style.fontSize = fontSize + 'px';
        document.getElementById('school_tag').style.margin = fontSize + 'px';
        document.getElementById('study_tag').style.margin = fontSize + 'px';
        document.getElementById('main_tag').style.margin = fontSize + 'px';
        document.getElementById('home_tag').style.margin = fontSize + 'px';
        document.getElementById('me_tag').style.margin = fontSize + 'px';

        document.getElementById('foot_tag').style.marginTop = -fontSize / 2 + 'px';

        document.getElementById('foot').style.height = (fontSize * 3 + imageSize) + 'px';
        document.getElementById('space').style.height = (fontSize * 3 + imageSize) + 'px';

    };

  </script>
</html>
